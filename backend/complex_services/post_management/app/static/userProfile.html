<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Profile</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/3.2.30/vue.global.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.5.0/firebase-auth-compat.js"></script>
    
  
    <script>

        const firebaseConfig = { 
            apiKey: "AIzaSyDvMDBVMhRhwjMCxByvbBlLEBI33glaKrU", 
            authDomain: "is216-e-wasteless.firebaseapp.com", 
            databaseURL: "https://is216-e-wasteless-default-rtdb.asia-southeast1.firebasedatabase.app", 
            projectId: "is216-e-wasteless", 
            storageBucket: "is216-e-wasteless.appspot.com", 
            messagingSenderId: "739112462842", 
            appId: "1:739112462842:web:a5d0e65a44163e23d4dc43", 
            measurementId: "G-3Q1JMEGCBE" 
        };


        // Initialize Firebase
        firebase.initializeApp(firebaseConfig)
        const auth = firebase.auth()

    </script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="axiosInterceptor.js"></script>  
    <style>
        section img{
            height: 50%;
            width: 50%;
        }
        #editProfile{
            transition: 0.5s ease;
        }
        #editProfile:hover{
            scale: 110%;
        }
        .editBtn{
          height: 50px;
          width: 50px;
          background-color: white;
          border: none;
          transition: 0.5s ease;
        }
        .editBtn img{
          scale: 200%;
        }
        .editBtn:hover{
          height: 55px;
          width: 55px;
          border: solid 1px grey;
        }
    </style>
</head>
<body>
  <script id="replace_with_navbar" src="navbar.js"></script>
      <h2 class="text-center">Profile Details</h1>

        <section class="border border-dark-subtle container rounded-4">

        <div class="container text-center">
            <div class="row text-center ">
                <h4 class="col-10 mx-auto my-auto d-flex justify-content-center">
                    Name: &nbsp;<span id="name"> </span></p>
                </h4>
                <h4 class=" col-10 mx-auto my-auto d-flex justify-content-center">
                    Email: &nbsp;<span id="email"> </span></p>
                </h4>
                <h4 class=" col-10 mx-auto my-auto d-flex justify-content-center">
                  Username: &nbsp;<span id="username"> </span></p>
                </h4>
                <h4 class=" col-10 mx-auto my-auto d-flex justify-content-center">
                  
                </h4>
            </div>

        </div>
    </section>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
   
    <script src="auth.js"></script>
    <script src="userProfile.js"></script>
    
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
      import { getFirestore, collection, addDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
      import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
      import { doc, updateDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";
      import { doc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
     // Your web app's Firebase configuration
     const firebaseConfig = {
      apiKey: "AIzaSyACeAF5_819WDlV2PM7FEQQ5R2YGGWklCM",
      authDomain: "techexchange-76048.firebaseapp.com",
      databaseURL: "https://techexchange-76048-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "techexchange-76048",
      storageBucket: "techexchange-76048.appspot.com",
      messagingSenderId: "396217100321",
      appId: "1:396217100321:web:ba771f3033a2caf6ec1b60",
      measurementId: "G-51BT4968FL"
    };
    
      // Initialize Firebase
      // const app = initializeApp(firebaseConfig);
      // const auth = firebase.auth();
      const app = initializeApp(firebaseConfig);

      // import {getDatabase, set, get, update, remove}
      // from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js"

      const db = getFirestore(app);
      // const analytics = getAnalytics(app);

      var name = document.querySelector("#enterName");
      var desc = document.querySelector("#enterDesc");
      var location = document.querySelector("#enterLocation");
      var findName = document.querySelector("#findName");
      var findDesc = document.querySelector("#findDesc");
      var findLocation = document.querySelector("#findLocation");

      var insertBtn = document.querySelector("#insert");
      var updateBtn = document.querySelector("#update");
      var removeBtn = document.querySelector("#remove");
      var findBtn = document.querySelector("#find");
      
     // Function to add a new post
    async function addPost(postData) {
      try {
        const docRef = await addDoc(collection(db, "post"), postData);
        console.log("Document written with ID: ", docRef.id);
      } catch (e) {
        console.error("Error adding document: ", e);
      }
    }

    async function deletePost(docId) {
      const docRef = doc(db, "post", docId);
      
      try {
        await deleteDoc(docRef);
        console.log("Document successfully deleted!");
      } catch (error) {
        console.error("Error removing document: ", error);
      }
    }

    async function updatePost(docId, updatedData) {
      const docRef = doc(db, "posts", docId);
      
      try {
        await updateDoc(docRef, updatedData);
        console.log("Document successfully updated!");
      } catch (error) {
        console.error("Error updating document: ", error);
      }
    }

// Example usage
var newPost = {
  name: name,
  desc: desc,
  location: location
};

// Insert
insertBtn.addEventListener('click', () => addPost(newPost));

// Delete
const deleteBtn = document.querySelector("#remove");
deleteBtn.addEventListener('click', () => {
  const docId = document.querySelector("#enterID").value; // Assuming the document ID is entered in the input field with ID "enterID"
  deletePost(docId);
});

//Get post based on user name and update
async function getPost(docId) {
      const docRef = doc(db, "post", docId);
      const docSnap = await getDoc(docRef);
      
      if (docSnap.exists()) {
        console.log("Document data:", docSnap.data());
        return docSnap.data();
      } else {
        console.log("No such document!");
        return null;
      }
    }

updateBtn.addEventListener('click', async () => {
  const titleToFind = document.querySelector("#enterName").value;
  const updatedContent = document.querySelector("#enterAge").value; // For demonstration purposes
  
  // Query Firestore to find the document by title
  const querySnapshot = await getDocs(query(collection(db, "post"), where("title", "==", titleToFind)));
  let docId = null;

  querySnapshot.forEach((doc) => {
      // Assuming the title is unique, we'll get only one result
      console.log(`${doc.id} => ${doc.data().title}`);
      docId = doc.id; // Get the document ID
  });

  // Proceed with the update if the document ID was found
  if (docId) {
      const updatedData = {
          title: titleToFind,
          content: updatedContent,
      };

      updatePost(docId, updatedData);
  } else {
      console.log("Document not found with the given title.");
  }
});

</script>

</body>
</html>
